{% extends 'basic.html' %}
{% block title%}Group Wise Dashboard{% endblock %}
{% block css %}
{% load static %}

<link rel="stylesheet" href="{% static  'DataTables/css/bootstrap.min.css' %}">
<link rel="stylesheet" href="{% static  'DataTables/css/buttons.bootstrap5.min.css' %}">
<link rel="stylesheet" href="{% static  'DataTables/css/dataTables.bootstrap5.min.css' %}">
<style>
    #example_wrapper{
        margin-top: 4% !important;
    }
    #example th{
        {% comment %} border: 0.1px solid black !important; {% endcomment %}
        text-align: center;
        width: 11%;
    }
    #example_filter{
        float: right;
        width: 50% !important;
    }
    .Input{
        item-align: center;
        width: 98.5% !important;
    }
    .dropdown-menu {
        min-width: 7rem !important;
        margin-top: 0 !important;
        background-color: #6c757d;
    }
    .buttons-colvis{
        left:-11px;
        width: 95px !important;
    }
    .buttons-collection{
        height: 35px;
        width: 100px !important;
    }
    {% comment %} .modal-backdrop.fade {
        opacity: 0;
    } {% endcomment %}
    .pagination {
        display: flex;
        justify-content: center;
        align-items: center;
    }
    

    .flex-wrap {
        position: relative !important;
        margin-top: -60px !important; 
        left: 63% !important; 
    }
    .form-control-sm {
        border: 0.3px solid black;
        height:30px !important;
      }
    .row.dt-row {
        margin-top: -23px !important; 
    }
    .cw {
        margin-left: -150px;
        width: 10%;
    }

    .custom-width {
        margin-left: 0px !important;
        right : 0px !important;
        width: 89% !important;
    }
    .dwo{
        margin-top: -2% !important;
    }
    .bi{
        height: 35px !important;
        text-align: center !important;
        margin-top: 1.7% !important;
    }

    #example_wrapper {
        margin-top: 5.2% ;
      }

    table{
        border-collapse: collapse;
        border-spacing: 0;
        width: 100%;
        border: 1px solid #ddd;
        margin-bottom: 2%;
        {% comment %} height : 75vh; {% endcomment %}
    }

    .container-fluid {
        width: 100%;
        margin-right: auto;
        margin-left: auto;
    }

    table th:nth-child(n+1){
        {% comment %} position : sticky;
        top:0; {% endcomment %}
        background :rgb(182, 182, 158);
    } 

    th,
    td {
        text-align: center;
        padding: 15px;
    }
    

    table td:nth-child(1){
        {% comment %} position : sticky; {% endcomment %}
        background :rgb(182, 182, 158);
        {% comment %} left : 0; {% endcomment %}
    }
    .sticky-col {
        position: sticky !important;
        left: 0;
        background: rgb(182, 182, 158); /* match your Group Name column color */
        z-index: 3; /* keep above other cells */
    }
    thead th {
        position: sticky !important;
        left: 0;
        background-color: #f1f1f1;
        z-index: 2;
    }
    tbody th {
        position: sticky !important;
        left: 0;
        background-color: #f1f1f1;
        z-index: 1;
    }
    tfoot th {
        position: sticky !important;
        left: 0;
        background-color: #f1f1f1;
        z-index: 1;
    }

    .h3,
    h3 {
        margin: 0px 0px;
        margin-top: 85px;
        font-size: 1.75rem;
        border-block-end: 3px solid #e9ecef;
    }

    .iponame {
        position:fixed !important;
        background-color: white;
        height: 45px;
        margin-top: 35px;
        width: 100%;
        text-align: center;
        text-align: center;
    }


    table.table-sortable th.currently-sorted[data-sort-dir="asc"]::after {
        content: "\25b2";

    }

    table.table-sortable th.currently-sorted[data-sort-dir="desc"]::after {
        content: "\25bc";

    }

    .col-md-3 {
        display: inline-block;
        margin-left: -4px;
    }

    @media (min-width: 1200px){
        .fc{
            margin-top: 3%;
        }
    }
    @media (min-width: 3951px) and (max-width: 8000px) {
        .btn-group.bi {
            width: 25%;
        }
        .fc {
            margin-top: 2% !important;
        }
        .bi{
            margin-left: 48% !important;
            margin-top: -0% !important;
        }
        #example_wrapper {
            margin-top: 0.3% !important;
        }
        #example_filter{
            float:left;
            margin-left: 77% !important;
            margin-top: 0%;
        } 
        .flex-wrap {
            left: 35% !important;
        }
        #example th{
            text-align: center;
            width: 11%;
        }
    }
    @media (min-width: 2851px) and (max-width: 3950px) {
        .btn-group.bi {
            width: 25%;
          
          }
          .fc {
            margin-top: 3% !important;
        }
        .bi{
            margin-left: 48% !important;
            margin-top: -0% !important;
        }
        #example_wrapper {
            margin-top: 0.3% !important;
        }
        #example_filter{
            float:left;
            margin-left: 77% !important;
            margin-top: 0%;
        } 
        .flex-wrap {
            left: 35% !important;
        }
        #example th{
            text-align: center;
            width: 11%;
        }
    }
    @media (min-width: 2480px) and (max-width: 2850px) {
        .btn-group.bi {
            width: 25%;
          
          }
          .fc {
            margin-top: 3.5% !important;
        }
        .bi{
            margin-left: 48% !important;
            margin-top: -0% !important;
        }
        #example_wrapper {
            margin-top: 0.3% !important;
        }
        #example_filter{
            float:left;
            margin-left: 72% !important;
            margin-top: 0%;
        } 
        .flex-wrap {
            left: 35% !important;
        }
        #example th{
            text-align: center;
            width: 11%;
        }
    }
    @media (min-width: 1951px) and (max-width: 2479px) {
        .btn-group.bi {
            width: 25%;
        }
        .fc {
            margin-top: 3.5% !important;
        }
        .bi{
            margin-left: 48% !important;
            margin-top: -0% !important;
        }
        #example_wrapper {
            margin-top: 1% !important;
        }
        #example_filter{
            float:left;
            margin-left: 63% !important;
            margin-top: 0%;
        } 
        .flex-wrap {
            left: 35% !important;
        }
        #example th{
            text-align: center;
            width: 11%;
        }
    }

    @media (min-width: 1541px) and (max-width: 1950px) {
        .btn-group.bi {
            width: 25%;
          
          }
          .fc {
            margin-top: 3.5% !important;
          }
        .bi{
            margin-left: 48% !important;
            margin-top: -0% !important;
            margin-bottom: 0% !important;
        }
        #example_wrapper {
            margin-top: 2.3% !important;
        }
        #example_filter{
            margin-right: 1% !important;
            margin-top: 0%;
        } 
        .flex-wrap {
            left: 35% !important;
            margin-top: -4% !important;
        }
        #example th{
            text-align: center;
            width: 11%;
        }
    }

    @media (min-width: 1200px) and (max-width: 1540px) {
        .bi{
            margin-top: 0% !important;
            left: 33%;
            margin: 0% !important;
        }
        #example_wrapper {
            margin-top: 4.6% !important;
        }
        #example_filter{
            margin-right: 32.5% !important;
            margin-top: 0%;
        } 
        .flex-wrap {
            left: 23% !important;
          }
    }

    @media (min-width: 992px) and (max-width: 1199px) {
        .bi{
            margin-top: 0% !important;
            left: 25%;
            max-width: 17%;
            margin-bottom: 0% !important;
        }

        .fc{
            margin-top: 8%;
        }
        .flex-wrap {
            left: 19% !important;
          }
        #example_filter {
            margin-right: 54%;
            margin-top: 5% !important;
        }
        #example_wrapper {
            margin-top: 1% !important;
          
          }
    }

    @media (min-width: 768px) and (max-width: 991px) {
        .fc{
            margin-top: 11%;
        }

        .bi{
            margin-top: 3%!important;
            max-width: 49% ;
            left: 38%;
            margin-bottom: 0% !important;
        }

        .addipomodal {
            margin: 0% -22%!important;
            position: fixed;
        }
        .flex-wrap{
            left: 28% !important;
            top: 6%;
        }
        #example_filter{
            margin-right: 80% !important;
            margin-top: -22%;
        } 
        #example_wrapper {
            margin-top: 2% !important;
          
        }
        
        #navbarNavAltMarkup{
            font-size: 97%;
        }
        .slr{
            margin-bottom: -3% !important;
        }
        {% comment %} .form-control-sm{
            width: 138% !important;
        } {% endcomment %}
    }
    @media (min-width: 700px) and (max-width: 767px) {
        .fc{
            margin-top: 18%;
        }
        .bi{
            top: -0.2rem !important;
            width: 54% !important;
            left: -17%;
        }
        .pymodel{
            margin: 1% -49.5% !important;
            width: 193%;
        }
        .iponame{
            margin-top: 54px;     
        }
        #example_wrapper {
            margin-top: -0.4% !important;
        }
        #example_length{
            margin-right: 46% !important;
        }
        #example_filter{
            margin-right: 139.5% !important;
            margin-top: 117%;
            margin-bottom: 10.5% !important;
        } 
        .flex-wrap{
            top: -3%;
            left: 73% !important;
            width: auto !important;
        }
        .row.dt-row {
            margin-top: -2% !important;
        }
        .slr{
            position: absolute;
            top: 56%;
            left: 1%;
        }
    }


    @media (min-width: 576px) and (max-width: 699px) {
        .fc{
            margin-top: 18%;
        }
        .bi{
            top: 3.2rem !important;
            width: 54% !important;
            left: 1%;
            margin: 0% !important;
        }
        .addipomodal {
            margin: -2% -91.5% !important;
            width: 193%;
        }
        .iponame{
            margin-top: 54px;     
        }
        #example_wrapper {
            margin-top: -0.4% !important;
        }
        #example_length{
            margin-right: 46% !important;
        }
        #example_filter{
            margin-right: 139.5% !important;
            margin-top: 117%;
            margin-bottom: 10.5% !important;
        } 
        .flex-wrap{
            top: 5%;
            left: 73% !important;
            width: auto !important;
        }
        .row.dt-row {
            margin-top: -2% !important;
        }
        .slr{
            position: absolute;
            top: 9%;
            left: 1%;
        }
    }

    @media (min-width: 427px) and (max-width: 575px) {
        .fc{
            margin-top: 23%;
        }

        .bi{
            top: -16.5% !important;
            width: 54% !important;
            left: 1% !important;
            margin: 0% !important;
        }

        .addipomodal {
            margin: 0% -64%!important;
            position: fixed;
        }

        .iponame{
            margin-top: 54px;     
        }
        #example_wrapper {
            margin-top: 4% !important;
        }
        #example_length{
            margin-right: 46% !important;
        }
        .flex-wrap{
            left: 3% !important;
            top: 37%;
        }
        #example_filter{
            margin-right: 158.5% !important;
            margin-top: 281%;
            margin-bottom: -1.5% !important;
        } 
        .row.dt-row {
            margin-top: -2% !important;
        }
        .slr{
            position: absolute;
            top: 76%;
            left: 1%;
        }
        .jvbtn{
            max-width: 131% !important;
            font-size: 96% !important;
        }
    }
    @media (min-width: 400px) and (max-width: 426px) {
        .fc{
            margin-top: 26%;
        }
        .bi{
            margin-top: 25.3% !important;
            width: 98%!important;
            left: -4%;
        }
        .addipomodal {
            margin: 0% -82%!important;
            position: fixed;
        }
        .iponame{
            margin-top: 54px;     
        }
        #example_wrapper {
            margin-top: -12% !important;
        }
        #example_length{
            margin-right: 46% !important;
            margin-top: 12% !important;
        }
        .flex-wrap{
            left: 12% !important;
            top: -0.5rem;
            width: auto !important;
        }
        .buttons-colvis{
            left: 0% !important;
            top: 5% !important;
            width: 89px !important;
        }
        .buttons-collection{
            top: 4% ;
            left: 16% ;
            width:97px ;
        }
        #example_filter{
            margin-right: 3rem !important;
            margin-top: 8.5rem;
            margin-bottom: 15.5% !important;
        } 
        #example_filter input{
            width: 200% !important;
        } 
        .row.dt-row {
            margin-top: 0rem !important;
        }
        .slr{
            position: absolute;
            top: 79%;
            left: 1%;
        }
        .jvbtn{
            max-width: 83% !important;
            font-size: 93% !important;
            bottom: 123% !important;
            left: 6% !important;
        }
        .flex-wrap div .btn-group{
            max-width: 60% !important;
            font-size: 68% !important;
            margin: 0% !important;
            padding: 0% !important;
            gap: 0% !important;
            space-between: 0% !important;
        }
    }

    @media (min-width: 385px) and (max-width: 399px) {
        .fc{
            margin-top: 33%;
        }

        .bi{
            margin-top: -0.7% !important;
            width: 106%!important;
            left: 8%;
        }

        .addipomodal {
            margin: -2% -48.5% !important;
            width: 193%;
        }

        .iponame{
            margin-top: 54px;     
        }
        #example_wrapper {
            margin-top: 3% !important;
        }
        #example_length{
            margin-right: 46% !important;
        }
        .flex-wrap{
            left: 2% !important;
            top: 1.7rem;
            width: auto !important;
        }
        .buttons-colvis{
            left: 0% !important;
            top: 5% !important;
            width: 89px !important;
        }
        .buttons-collection{
            top: 4% ;
            left: 16% ;
            width:97px ;
        }
        #example_filter{
            margin-right: 0.8rem !important;
            margin-top: 7.5rem;
            margin-bottom: -30.5% !important;
        } 
        .row.dt-row {
            margin-top: 0rem !important;
          
        }
        .slr{
            margin-top: 71%;
            margin-bottom: -66% !important;
            margin-left: 4% !important;
        }
        .jvbtn{
            max-width: 85% !important;
            font-size: 83% !important;
            bottom: 43% !important;
            left: -4% !important;
        }
        #example_filter input{
            width: 150% !important;
        }
    }

    @media (min-width: 316px) and (max-width: 384px) {
        .fc{
            margin-top: 33%;
        }

        .bi{
            margin-top: -0.7% !important;
            width: 106%!important;
            left: 8%;
        }

        .addipomodal {
            margin: -2% -48.5% !important;
            width: 193%;
        }

        .iponame{
            margin-top: 54px;     
        }
        #example_wrapper {
            margin-top: 3% !important;
        }
        #example_length{
            margin-right: 46% !important;
        }
        .flex-wrap{
            left: 2% !important;
            top: 1.7rem;
            width: auto !important;
        }
        .buttons-colvis{
            left: 0% !important;
            top: 5% !important;
            width: 89px !important;
        }
        .buttons-collection{
            top: 4% ;
            left: 16% ;
            width:97px ;
        }
        #example_filter{
            margin-right: 7.8rem !important;
            margin-top: 8.5rem;
            margin-bottom: -30.5% !important;
        } 
        .row.dt-row {
            margin-top: 0rem !important;
          
        }
        .slr{
            margin-top: 37%;
            margin-bottom: -109% !important;
            margin-left: 4% !important;
        }
        .jvbtn{
            max-width: 85% !important;
            font-size: 83% !important;
            bottom: 43% !important;
            left: -4% !important;
        }
        #example_filter input{
            width: 150% !important;
        }
    }

    @media (min-width: 295px) and (max-width: 315px){ 
        .bi{
            margin-top:-15.5%!important;
            margin-right: 2% !important;
            width: 100%!important;
            box-sizing: border-box;
            display: flex;            /* enable flex */
            flex-direction: column;
        }

        .addipomodal {
            margin: -2% -48.5% !important;
            width: 193%;
        }

        .iponame{
            margin-top: 54px;     
        }

        .fc{
            margin-top: 33%;
        }
        #example_wrapper {
            margin-top: 4% !important;
        }
        #example_length{
            margin-right: 46% !important;
        }
        .flex-wrap{
            left: 6% !important;
            top: 7.5rem;
            width: auto !important;
        }
        .buttons-colvis{
            left: 0% !important;
            top: 5% !important;
            width: 89px !important;
        }
        .buttons-collection{
            top: 4% ;
            left: 16% ;
            width:97px ;
        }
        #example_filter{
            margin-right: 5.8rem !important;
            margin-top: 12.5rem;
            margin-bottom: 5.5% !important;
        } 
        .row.dt-row {
            margin-top: 0rem !important;
          
          }
          .pysubbtn {
            font-size: 73%;
            width: 126%;
        }
        .slr{
            margin-top: 10%;
            margin-bottom: -269% !important;
            margin-left: 15% !important;
        }
    }

    @media (min-width: 280px) and (max-width: 294px){ 
        .bi{
            margin-top: -3.5% !important;
            width: 100% !important;
            display: flex;            /* enable flex */
            flex-direction: column;
        }

        .addipomodal {
            margin: -2% -48.5% !important;
            width: 193%;
        }

        .iponame{
            margin-top: 54px;
            height: 74px;    
        }
        .pysubbtn {
            font-size: 73%;
            width: 126%;
        }

        .fc{
            margin-top: 48%;
        }
        .custom-width {
            margin-left: 0px !important;
            left: 0.2rem !important;
            width: 89% !important;
        }
        h5 {
            font-size: 77.25%;
        }
        .slr{
            margin-top: -97%;
            margin-bottom: -269% !important;
            margin-left: 0% !important;
        }
        #example_filter{
            margin-right: 5.8rem !important;
            margin-top: 13.5rem;
            margin-bottom: 106.5% !important;
        }
        .flex-wrap{
            left: 6% !important;
            top: 7.5rem;
            width: auto !important;
        }
    }
    .dataTables_wrapper .dt-buttons {
        text-align: center !important;
        margin-bottom: 10px;
    }
    
    .dataTables_wrapper .dataTables_filter {
        text-align: center !important;
        margin: 10px 0;
    }
    
    .dataTables_wrapper .dataTables_filter input {
        margin: 0 auto;
        display: inline-block;
    }
    
    .dataTables_wrapper .dataTables_length {
        display: flex;
        {% comment %} justify-content: center; {% endcomment %}
        align-items: center;
        flex-wrap: wrap;
        gap: 10px;
    }
</style>

<!-- <link rel="stylesheet" href="{% static 'JS/jquery-ui.css' %}"> -->

{% endblock %}
{% block body %}

{% csrf_token %}

{% comment %} <script src="{% static 'JS/bootstrap.min.js' %}"></script>
<script src="{% static 'JS/jquery-1.11.1.min.js' %}"></script>
<script src="{% static 'JS/jquery.dataTables.min.js' %}"></script>
<script src="{% static 'JS/dataTables.bootstrap4.min.js' %}"></script> {% endcomment %}

<h3 class="fixed-top iponame" style="z-index: 9; ">Group Wise Dashboard</h3>


<script src="{% static 'JS/sorttable.js' %}"></script>

{% comment %} <div class="card" style="margin: 5% 0%; border: none;"> {% endcomment %}
    {% comment %} <div class="card-body tscroll"> {% endcomment %}
<div class="container-fluid fc">
    <div class="table-responsive text-nowrap table-wrapper-scroll-x table-wrapper-scroll-y my-custom-scrollbar"> 
        <table id="example" class="table-bordered table-hover table-sortable" style='width:100%;'>

            {% comment %} <thead>
                <tr style="text-align: center; white-space: nowrap;">
                    <th scope="col" style="width:90px;">Group Name</th>
                    {% for col in df.columns %}
                    <th scope="col">{{col}}</th>
                    {% endfor %}
                </tr>
            </thead> {% endcomment %}
            <div>
                <!-- BUTTON OF EDIT MODAL -->
                {% comment %} <button type="button" class="btn btn-outline-primary bi d-flex justify-content-center align-items-center" style="float:right; margin: 12px 16px; width: 9.5%;" data-bs-toggle="modal"
                    onclick="document.getElementById('edit').style.display='block'" data-bs-target="#edit">Payment</button> {% endcomment %}
                <!--NEW  Modal FOR EDIT MODAL-->
                <div class="modal pymodel fade addipomodal" id="edit" tabindex="-1" role="dialog"
                    aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-dialog1" role="document" style="padding: 0 60px; margin: 5px auto;">
                        <div class="modal-content"
                            style="text-align: justify; background-color: whitesmoke; border-radius: 40px; border: 1px solid black;">
                            <div class="modal-body">
                                <div class="modal-header"
                                    style="background: rgb(49, 183, 183); color: white; border-radius: 40px; border: 3px solid black; text-align: center; display: block;">
                                    <b>
                                        <h5 class="modal-title" id="exampleModalLabel">Payment</h5>
                                    </b>
                                    <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close"
                                        style="margin: -45px 0;">X</button>
                                </div>
                                <form action="/AddPayment" method="post" class="needs-validation"
                                    style="margin: 10px 20px;" novalidate>{% csrf_token %}
                                    <div class="form-group">
                                        <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script> -->
    
                                        {% comment %} <script>
    
                                            $("#success-alert").fadeTo(5000, 500).slideUp(500, function () {
                                                $("#success-alert").slideUp(500);
                                            });
                                        </script> {% endcomment %}
    
                                        <label for="Group" class="form-label"><b>Group&nbsp;<font color="red">*</font></b></label>
                                        <select class="form-control" name="Group" autocomplete="off" id="Group" required>
                                            <option disabled selected value="">Select Group</option>
                                            {% for j in entry_sorted %}
                                            <option value="{{ j.GroupName }}">{{ j.GroupName }}</option>
                                            {% endfor %}
                                        </select>
                                        <div class="invalid-feedback">
                                            Please Select A Valid Group.
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label for="IPOPrice" class="form-label"><b>Amount&nbsp;<font color="red">*</font>
                                                </b></label>
                                        <input type="text" class="form-control" placeholder="Enter Amount" id="IPOPrice"
                                            oninput="this.value = this.value.replace(/[^0-9.-]/g, '').replace(/(\..*)\./g, '$1');"
                                            name='Amount' maxlength="10" required>
                                        <div class="invalid-feedback">
                                            Please Enter Amount.
                                        </div>
                                    </div>

                                    <div class="modal-footer" style="border-top: 1px solid black;">
                                        <button type="button" class="btn btn-outline-secondary"
                                            data-bs-dismiss="modal">Close</button>
                                        <button type="submit" class="btn btn-outline-primary pysubbtn">Submit Form</button>
                                    </div>
                                </form>
                            </div>
                            <!-- JAVASCRIPT FOR ADDGROUP FORM VALIDATION -->
                            <script>
                                // Example starter JavaScript for disabling form submissions if there are invalid fields
                                (function () {
                                    'use strict'

                                    // Fetch all the forms we want to apply custom Bootstrap validation styles to
                                    var forms = document.querySelectorAll('.needs-validation')

                                    // Loop over them and prevent submission
                                    Array.prototype.slice.call(forms)
                                        .forEach(function (form) {
                                            form.addEventListener('submit', function (event) {
                                                if (!form.checkValidity()) {
                                                    event.preventDefault()
                                                    event.stopPropagation()
                                                }

                                                form.classList.add('was-validated')
                                            }, false)
                                        })
                                })()
                            </script>
                            <!-- JAVASCRIPT FOR ADDGROUP FORM WITHOUT ENTERING ANY NUMBER USER CANNOT TO BE NEXT INPUT -->
                            <script>
                                $(document).ready(function () {
                                    $('#GroupName').focusout(function () {
                                        var thisValue = $(this).val();
                                        if (thisValue.trim() == '') {
                                            $(this).next().show();
                                            $(this).focus();
                                        } else {
                                            $(this).next().hide();
                                        }
                                    });

                                });
                            </script>
                           
                        </div>
                    </div>
                </div>

            </div>


            <div style ="margin-top:5px;">
                <!-- BUTTON OF EDIT MODAL -->
                {% comment %} <button type="button" class="btn btn-secondary dwo" data-toggle="modal" style="float:right; margin: 24px 15px; width: 10%;"
                                data-target="#exampleModals">Download &nbsp; <i class="fa fa-download" aria-hidden="true"
                                    style='font-size:18px;'></i>
                </button> {% endcomment %}
                <!--NEW  Modal FOR EDIT MODAL-->
                <div class="modal fade" id="exampleModals" tabindex="-1" role="dialog"
                    aria-labelledby="exampleModalLabels" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header" style="border-bottom: 1px solid black;">
                                <h5 class="modal-title" id="exampleModalLabels">Download File &nbsp; <i
                                        class="fa fa-download" aria-hidden="true" style='font-size:18px;'></i></h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                {{prompt}}
                                <form method="POST"     {% if IPOName.IPOType == "MAINBOARD" %} action="download-Groupwise" 
                                {%else%}  action="download-Groupwise" {%endif%} >
                                    {% csrf_token %}
                                    <label><b style="margin: 0 12px;"> Download File :</b></label>
                                    <button type="submit" class="btn btn-primary"> Download &nbsp;<i
                                            class="fa fa-file-excel-o" aria-hidden="true"
                                            style='font-size:18px;'></i></button>
                                </form>
                                {% for profile in entry%}
                                {{profile.name}}
                                {% endfor %}
                            </div>
                            {% comment %} <div class="modal-body">
                                {{prompt}}
                                <form method="POST" {% if IPOName.IPOType == "MAINBOARD" %} action="download-Billing-Pdf" 
                                {%else%}  action="download-Billing-Pdf" {%endif%} >
                                    {% csrf_token %}
                                    <label><b style="margin: 0 12px;"> Download PDF :</b></label>
                                    <button type="submit" class="btn btn-primary"> Download &nbsp;<i
                                            class="fa fa-file-pdf-o" aria-hidden="true"
                                            style='font-size:18px;'></i></button>
                                </form>
                                {% for profile in entry%}
                                {{profile.name}}
                                {% endfor %}
                            </div> {% endcomment %}
                        </div>
                    </div>
                </div>                            
            </div>
            <div class="modal fade" id="transactionModal" tabindex="-1" role="dialog">
                <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                    
                        <form action="/add_transaction_group/" method="post">
                            {% csrf_token %}
                            <div class="modal-header">
                                <h5 class="modal-title">Add Transaction</h5>
                                <button type="button" class="close" data-dismiss="modal"><span>&times;</span></button>
                            </div>

                            <div class="modal-body">
                                 
                                <div class="form-group" id="ipoFieldContainer">
                                    <label for="trans_ipo">IPO</label>
                                    <select id="trans_ipo" name="ipo_id" class="form-control" required>
                                        {% for ipo in ipos %}
                                        <option value="{{ ipo.id }}">{{ ipo.IPOName }}</option>
                                        {% endfor %}
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label for="trans_group">Group</label>
                                    <select id="trans_group" name="group_id" class="form-control" required>
                                        {% for group in groups %}
                                        <option value="{{ group.id }}">{{ group.GroupName }}</option>
                                        {% endfor %}
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label for="trans_amount_type">Amount Type</label>
                                    <select id="trans_amount_type" name="amount_type" class="form-control" required>
                                        <option value="credit">Credit</option>
                                        <option value="debit">Debit</option>
                                    </select>
                                </div>
                            
                                <div class="form-group">
                                    <label for="trans_amount">Amount</label>
                                    <input type="number" step="0.01" id="trans_amount" name="amount" class="form-control" required>
                                </div>

                                <div class="form-group">
                                    <label for="trans_remark">Remark</label>
                                    <input type="text" id="trans_remark" name="remark" class="form-control">
                                </div>

                                <div class="form-group">
                                    <label for="add_date_time">Date & Time</label>
                                    {% comment %} <input type="datetime-local" id="add_date_time" name="date_time" class="form-control" required> {% endcomment %}
                                    <input tabindex="-1" type="datetime-local" style="width: 100%;" class="form-control width" step="1" name="date_time" id="add_date_time" value='{% now "Y-m-d H:i:s" %}'  min="2020-01-01T00:00" max="2035-12-31T23:59:59" required>
                                </div>

                                <div class="form-check mb-3">
                                    <input type="checkbox" id="trans_jv" name="jv" class="form-check-input" value="1" onchange="toggleIpoField()">
                                    <label class="form-check-label" for="trans_jv">JV Transaction</label>
                                </div>
                                
                                <script>
                                    function toggleIpoField() {
                                        const ipoField = document.getElementById('trans_ipo').closest('.form-group');
                                        if (document.getElementById('trans_jv').checked) {
                                            ipoField.style.display = 'none';
                                        } else {
                                            ipoField.style.display = 'block';
                                        }
                                    }
                                    // Initialize on page load
                                    document.addEventListener('DOMContentLoaded', function() {
                                        toggleIpoField();
                                    });
                                </script>
                                    
                                
                            </div>

                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary " data-bs-dismiss="modal"  >Close</button>
                                {% comment %} <button type="button" class="btn btn-close btn-secondary "  data-bs-dismiss="modal" aria-label="Close">Close</button> {% endcomment %}
                                <button type="submit" class="btn btn-primary">Save</button>
                            </div>
                        </form>

                    </div>
                </div>
            </div>
            <div class="modal fade" id="transactionModal1" tabindex="-1" role="dialog">
                <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                        <form id="nonJVForm" method="post" action="{% url 'save_transaction_group' %}">
                            {% csrf_token %}
                            <div class="modal-header">
                                <h5 class="modal-title">Add Transaction (Non-JV)</h5>
                                <button type="button" class="btn-close" data-dismiss="modal" aria-label="Close"></button>
                            </div> 

                            <div class="modal-body">
                                <div class="row">
                                    <!-- Left Side (User fills) -->
                                    <div class="col-md-6">
                                        <label>IPO</label>
                                        <select name="ipo_id" id="ipo_id" class="form-select" required>
                                            {% for ipo in ipos %}
                                                <option value="{{ ipo.id }}" {% if forloop.first %}selected{% endif %}>{{ ipo.IPOName }}</option>
                                            {% endfor %}
                                        </select>

                                        <label>Group</label>
                                        <select name="group_id" id="group_id" class="form-select" required>
                                            {% for group in groups %}
                                                <option value="{{ group.id }}" {% if forloop.first %}selected{% endif %}>{{ group.GroupName }}</option>
                                            {% endfor %}
                                        </select>

                                        <label>Amount</label>
                                        <input type="number" name="amount" id="amount" step="0.01" class="form-control" required>

                                        <label>Amount Type</label>
                                        <select name="amount_type" id="amount_type" class="form-select" required>
                                            <option value="credit">Credit</option>
                                            <option value="debit">Debit</option>
                                        </select>

                                        <label>Remark</label>
                                        <input type="text" name="remark" id="remark" class="form-control">

                                        <label>Date & Time</label>
                                        {% comment %} <input type="datetime-local" id="date_time" name="date_time"
                                            class="form-control"
                                            value="{{ now|date:'Y-m-d\\TH:i' }}"> {% endcomment %}
                                        <input tabindex="-1" type="datetime-local" style="width: 100%;" class="form-control width" step="1" name="date_time" id="date_time" value='{% now "Y-m-d H:i:s" %}' min="2020-01-01T00:00:00" max="2035-12-31T23:59:59" required>
                                    </div>

                                    <!-- Right Side (Auto JV) -->
                                    <div class="col-md-6">

                                        <h6> </h6></br>

                                        
                                        <input class="form-check-input" type="checkbox" id="jv_checkbox" name="jv_checkbox" checked disabled>
                                        <label class="form" for="jv_checkbox">
                                            JV Entry 
                                        </label></br>
                                        

                                        <label>Group</label>
                                        
                                        <select id="jv_group" name="jv_group_id" class="form-select">
                                            {% for group in groups %}
                                                <option value="{{ group.id }}">{{ group.GroupName }}</option>
                                            {% endfor %}
                                        </select>
                                        {% comment %} <input type="hidden" id="jv_group" name="jv_group_id"> {% endcomment %}

                                        <label>Amount</label>
                                        <input type="number" id="jv_amount_display" name="jv_amount" step="0.01" class="form-control" readonly>
                                        <input type="hidden" id="jv_amount" name="jv_amount">

                                        <label>Amount Type</label>
                                        <input type="text" id="jv_amount_type_display" name="jv_amount_type" class="form-control" readonly>
                                        <input type="hidden" id="jv_amount_type" name="jv_amount_type">

                                        <label>Remark</label>
                                        <input type="text" id="jv_remark_display" name="jv_remark" class="form-control" >
                                        <input type="hidden" id="jv_remark" name="jv_remark">

                                        <label>Date & Time</label>
                                        
                                        <input tabindex="-1" type="datetime-local" style="width: 100%;" class="form-control width" step="1" name="date_time" id="date_time" value='{% now "Y-m-d H:i:s" %}' min="2020-01-01T00:00:00" max="2035-12-31T23:59:59" readonly>


                                        <!-- Flag to tell Django this is JV mode -->
                                        <input type="hidden" name="jv_entry" value="true">
                                    </div>
                                </div>
                            </div>

                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                <button type="submit" class="btn btn-primary">Save Transaction</button>
                            </div>
                        </form>
                        <script>
                            // Default JV remark template
                            function getDefaultJVRemark() {
                                const amount = document.getElementById('amount').value;
                                const amountType = document.getElementById('amount_type').value;
                                const groupName = document.getElementById('group_id').selectedOptions[0].text;
                                const ipoName = document.getElementById('ipo_id').selectedOptions[0].text;

                                // Build your default remark string
                                return `JV from ${groupName} for ${ipoName}`;
                            }

                            function updateJVDisplay() {
                                // Update amount
                                const amount = document.getElementById('amount').value;
                                document.getElementById('jv_amount_display').value = amount;
                                document.getElementById('jv_amount').value = amount;

                                // Update amount type (opposite of selected)
                                const amountType = document.getElementById('amount_type').value;
                                const jvAmountType = amountType === 'credit' ? 'debit' : 'credit';
                                document.getElementById('jv_amount_type_display').value = jvAmountType.charAt(0).toUpperCase() + jvAmountType.slice(1);
                                document.getElementById('jv_amount_type').value = jvAmountType;
                                

                                // Update remark
                                const jvRemarkInput = document.getElementById('jv_remark_display');
                                const jvHiddenRemark = document.getElementById('jv_remark');

                                const defaultRemark = getDefaultJVRemark();

                                if (!jvRemarkInput.dataset.edited) {
                                    // Set default remark if user hasn't edited manually
                                    jvRemarkInput.value = defaultRemark;
                                    jvHiddenRemark.value = defaultRemark;
                                } else {
                                    // If user edited, append default remark at the end
                                    jvHiddenRemark.value = jvRemarkInput.value ;
                                }
                            }

                            document.addEventListener('DOMContentLoaded', function() {
                                updateJVDisplay();

                                document.getElementById('amount').addEventListener('input', updateJVDisplay);
                                document.getElementById('amount_type').addEventListener('change', updateJVDisplay);
                                document.getElementById('group_id').addEventListener('change', updateJVDisplay);
                                document.getElementById('ipo_id').addEventListener('change', updateJVDisplay);

                                const jvRemarkInput = document.getElementById('jv_remark_display');
                                jvRemarkInput.addEventListener('input', function() {
                                    jvRemarkInput.dataset.edited = true;
                                    document.getElementById('jv_remark').value = jvRemarkInput.value;
                                });

                                const modal = document.getElementById('transactionModal1');
                                if (modal) {
                                    modal.addEventListener('shown.bs.modal', function() {
                                        updateJVDisplay();
                                    });
                                }
                            });
                        </script>
                    </div>
                </div>
            </div>
            
        {{ html_table | safe }}
            
            {% comment %} <tbody>
                {% for index, row in df.iterrows %}
                <tr>
                    <td>
                        {{index}}
                    </td>
                    {% for cell in row %}
                    <td>
                        {{cell|floatformat:1}}
                    </td>
                    {% endfor %}
                </tr>
                {% endfor %}
            </tbody>

            <tfoot>
                <tr>
                    <th style="width:90px;">Total</th>
                    {% for cell in IPOAmount %}
                    <td>
                        {{cell|floatformat:1}}
                    </td>
                    {% endfor %}
                    
                    <td>{{Total|floatformat:1}}</td>
                    <td>{{SumCollection|floatformat:1}}</td>
                    <td>{{DueAmountSum|floatformat:1}}</td>
                </tr>
            </tfoot>  {% endcomment %}

        </table>
    </div>
    <!-- Delete Modal -->
    {% for ipo in IPOName %}
        <div class="modal fade" id="deleteModal-{{ ipo.id }}" tabindex="-1" role="dialog" aria-labelledby="deleteModalLabel-{{ ipo.id }}" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteModalLabel-{{ ipo.id }}">Delete IPO</h5>
                <button type="button" class="btn-close" data-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete IPO <strong>{{ ipo.IPOName }}</strong>?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary " class="close-btn" data-dismiss="modal">Cancel</button>
                <a href="{% url 'destroy' ipo.id %}" class="btn btn-danger">Delete</a>
            </div>
            </div>
        </div>
        </div>
    {% endfor %}
        {% comment %} html_table += f"""
                <!-- Delete Modal -->
                <div class="modal fade" id="deleteModal-{ipo.id}" tabindex="-1" role="dialog"
                    aria-labelledby="deleteModalLabel-{ipo.id}" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="deleteModalLabel-{ipo.id}">Delete IPO</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                Are you sure you want to delete IPO <b>{ipo.IPOName}</b>?
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-outline-secondary" data-dismiss="modal">Cancel</button>
                                <button type="button" class="btn btn-outline-danger"
                                    onclick="er}window.location.href='/delete/{ipo.id}?page={page_numb';">
                                    Delete
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            """ {% endcomment %}

    <div class="row">
        <div class="col-md-6">
            <!-- Total rows and current range display (left aligned) -->
            <p class="text-left">
                Showing {{ page_obj.start_index }} to {{ page_obj.end_index }} of {{ page_obj.paginator.count }} Rows
            </p>
        </div>
        
        {% comment %} <div class="col-md-6">
            <ul class="pagination justify-content-end text-left" style="margin: 0; margin-right:2%;">
                <!-- First page link -->
                <li class="page-item">
                    <a class="page-link" href="/GroupWiseDashboard?page=1">First</a>
                </li>
                
                <!-- Previous page link -->
                {% if page_obj.has_previous %}
                    <li class="page-item">
                        <a class="page-link" href="/GroupWiseDashboard?page={{ page_obj.previous_page_number }}">Previous</a>
                    </li>
                {% else %}
                    <li class="page-item disabled">
                        <span class="page-link">Previous</span>
                    </li>
                {% endif %}
                
                <!-- Current page number -->
                <li class="page-item active">
                    <a class="page-link">{{ page_obj.number }}</a>
                </li>
                
                <!-- Next page link -->
                {% if page_obj.has_next %}
                    <li class="page-item">
                        <a class="page-link" href="/GroupWiseDashboard?page={{ page_obj.next_page_number }}">Next</a>
                    </li>
                {% else %}
                    <li class="page-item disabled">
                        <span class="page-link">Next</span>
                    </li>
                {% endif %}
                
                <!-- Last page link -->
                <li class="page-item">
                    <a class="page-link" href="/GroupWiseDashboard?page={{ page_obj.paginator.num_pages }}">Last</a>
                </li>
            </ul>
        </div>  {% endcomment %}

        <div class="col-md-6">
            <ul class="pagination justify-content-end text-left" style="margin: 0; margin-right:2%;">
                <!-- Always show the first page -->
                {% if page_obj.number != 1 %}
                    <li class="page-item">
                        <a class="page-link" href="/GroupWiseDashboard?page=1">1</a>
                    </li>
                {% endif %}
                
                <!-- Show ellipsis if current page is greater than 4 -->
                {% if page_obj.number > 4 %}
                    <li class="page-item disabled">
                        <span class="page-link">...</span>
                    </li>
                {% endif %}
                
                <!-- Display pages before the current page -->
                {% for num in page_obj.paginator.page_range %}
                    {% if num > 1 and num < page_obj.number and num >= page_obj.number|add:'-2' %}
                        <li class="page-item">
                            <a class="page-link" href="/GroupWiseDashboard?page={{ num }}">{{ num }}</a>
                        </li>
                    {% endif %}
                {% endfor %}
                
                <!-- Display current page -->
                <li class="page-item active">
                    <span class="page-link">{{ page_obj.number }}</span>
                </li>
                
                <!-- Display pages after the current page -->
                {% for num in page_obj.paginator.page_range %}
                    {% if num > page_obj.number and num < page_obj.number|add:'3' and num < page_obj.paginator.num_pages %}
                        <li class="page-item">
                            <a class="page-link" href="/GroupWiseDashboard?page={{ num }}">{{ num }}</a>
                        </li>
                    {% endif %}
                {% endfor %}
                
                <!-- Show ellipsis if current page is less than num_pages - 3 -->
                {% if page_obj.number < page_obj.paginator.num_pages|add:'-3' %}
                    <li class="page-item disabled">
                        <span class="page-link">...</span>
                    </li>
                {% endif %}
                
                <!-- Always show the last page -->
                {% if page_obj.number != page_obj.paginator.num_pages %}
                    <li class="page-item">
                        <a class="page-link" href="/GroupWiseDashboard?page={{ page_obj.paginator.num_pages }}">{{ page_obj.paginator.num_pages }}</a>
                    </li>
                {% endif %}
            </ul>
        </div>
    </div>

</div> 

{% comment %} <script>
    $(document).ready(function () {
        $('#bootstrapdatatable').DataTable({
            "aLengthMenu": [[25, 50, 100, -1], [25, 50, 100, "All"]],
            "iDisplayLength": 25
        }
        );
    });
</script>

<script>
    $('table.table-sortable th').on('click', function (e) {
        sortTableByColumn(this)
    })

    function sortTableByColumn(tableHeader) {
        // extract all the relevant details
        let table = tableHeader.closest('table')
        let index = tableHeader.cellIndex
        let sortType = tableHeader.dataset.sortType
        let sortDirection = tableHeader.dataset.sortDir || 'asc' // default sort to ascending

        // sort the table rows
        let items = Array.prototype.slice.call(table.rows);
        let sortFunction = getSortFunction(sortType, index, sortDirection)
        let sorted = items.sort(sortFunction)

        // remove and re-add rows to table
        for (let row of sorted) {
            let parent = row.parentNode
            let detatchedItem = parent.removeChild(row)
            parent.appendChild(row)
        }

        // reset heading values and styles
        for (let header of tableHeader.parentNode.children) {
            header.classList.remove('currently-sorted')
            delete header.dataset.sortDir
        }

        // update this headers's values and styles
        tableHeader.dataset.sortDir = sortDirection == 'asc' ? 'desc' : 'asc'
        tableHeader.classList.add('currently-sorted')
    }
    function getSortFunction(sortType, index, sortDirection) {
        let dir = sortDirection == 'asc' ? -1 : 1
        switch (sortType) {
            case 'text': return stringRowComparer(index, dir);
            case 'numeric': return numericRowComparer(index, dir);
            default: return stringRowComparer(index, dir);
        }
    }

    // asc = alphanumeric order - eg 0->9->a->z
    // desc = reverse alphanumeric order - eg z->a->9->0
    function stringRowComparer(index, direction) {
        return (a, b) => -1 * direction * a.children[index].textContent.localeCompare(b.children[index].textContent)
    }

    // asc = higest to lowest - eg 999->0
    // desc = lowest to highest - eg 0->999
    function numericRowComparer(index, direction) {
        return (a, b) => direction * (Number(a.children[index].textContent) - Number(b.children[index].textContent))
    }
</script> {% endcomment %}
<script>
    $(document).ready(function() {
        // Handle double-click on amount cells
        $(document).on('dblclick', '.amount-cell', function() {
            // Get data from the clicked cell
            const ipoId = $(this).data('ipo-id');
            const ipoName = $(this).data('ipo-name');
            const groupId = $(this).data('group-id');
            const groupName = $(this).data('group-name');
            const amount = $(this).text().trim();
            
            // Set the values in the transaction modal form
            $('#trans_ipo').val(ipoId).trigger('change');
            $('#trans_group').val(groupId).trigger('change');
            
            // Set the amount (convert to positive if negative)
            const amountNum = Math.abs(parseFloat(amount));
            $('#trans_amount').val(amountNum);
            
            // Auto-select debit for negative amounts
            if (parseFloat(amount) < 0) {
                $('#trans_amount_type').val('debit');
            } else {
                $('#trans_amount_type').val('credit');
            }
            
            // Set the current local date and time
            const now = new Date();
            const formattedUTC = now.toISOString().slice(0, 19);
            
            // Show the modal
            $('#transactionModal').modal('show');
            $('#transactionModal').modal('hide');
            
            // Focus on the remark field for quick entry
            setTimeout(function() {
                $('#trans_remark').focus();
            }, 500);
        });
        $('#transactionModal').on('hidden.bs.modal', function () {
            $('body').removeClass('modal-open');
            $('.modal-backdrop').remove();
        });
    });
</script>

<script>
    $(document).ready(function() {
        $(".alert").each(function() {
            var alert = $(this);
            setTimeout(function() {
                alert.fadeOut(500, function() {
                    alert.remove();
                });
            }, 3000); // 5000 milliseconds = 5 seconds
        });
    });
</script>
{% comment %} 
<script>
function deleteIPO(ipoId, pageNumber, btn) {
    if (!confirm("Are you sure you want to delete this IPO?")) {
        return false;
    }

    if (btn) {
        btn.disabled = true;
        btn.textContent = "Deleting...";
    }

    fetch(`/delete/${ipoId}/?page=${pageNumber}`, {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "X-CSRFToken": "{{ csrf_token }}"
        }
    })
    .then(res => {
        if (!res.ok) throw new Error("Network response was not ok");
        return res.json();
    })
    .then(data => {
        if (data.success) {
            alert("IPO deleted successfully!");
            location.reload(); // refresh table
        } else {
            alert("Error: " + (data.error || "Unknown error occurred"));
        }
    })
    .catch(error => {
        console.error("Error:", error);
        alert("Something went wrong while deleting IPO.");
    })
    .finally(() => {
        if (btn) {
            btn.disabled = false;
            btn.textContent = "Delete";
        }
    });
}
</script> {% endcomment %}

<script>
    $(document).ready(function () {
        {% comment %} $('#example thead tr')
            .clone(true)
            .addClass('filters')
            .appendTo('#example thead'); {% endcomment %}
        
        var scrollYHeight = window.innerHeight * 0.65;

        var pageLength = "{{ GWD_page_size|default:'50' }}";
        pageLength = pageLength === "All" ? -1 : parseInt(pageLength, 10);

        var table = $('#example').DataTable({
            orderCellsTop: true,
            {% comment %} fixedHeader: true, {% endcomment %}
            scrollY:scrollYHeight,
            scrollX:true,
            {% comment %} lengthMenu: [50, 100, 150, 200,-1], {% endcomment %}
            lengthChange: true,
            info:false,
            "pageLength": pageLength,
            buttons: [ {
                text: 'Columns', 
                extend: 'colvis',
            },
            {   
                extend: 'collection',
                text: 'Download',
                buttons:[
                    {
                        extend: 'excel',
                        text: 'Excel',
                        /*exportOptions: {
                            columns: [1, 2, 3, 4,5,6,7,8,9,10,11,12],
                        },*/
                        customize: function(xlsx) {
                            var sheet = xlsx.xl.worksheets['sheet1.xml'];
                    
                            {% comment %} $('row:first', sheet).remove(); {% endcomment %}
                        }
                    },
                    {% comment %} {
                        extend: 'pdf',
                        text: 'PDF',
                        exportOptions: {
                            /*columns: [0, 1, 2, 3, 4,5,6,7,8,9,10,11,12],*/
                            rows: ':visible',
                            modifier: {
                                page: 'current'
                            }
                        },
                        customize: function(doc) {
                           doc.pageMargins = [0, 50, 100, 100];
                           doc.styles.tableHeader = {
                                fillColor: 'grey',
                                color: 'whitesmoke',
                                bold: true,
                                alignment: 'center',
                            };
                            doc.styles.tableBodyEven = {
                                alignment: 'center',
                                fillColor: 'bisque',
                            };
                            doc.styles.tableBodyOdd = {
                                alignment: 'center',
                                fillColor: 'bisque',
                            };
                            
                            /*doc.pageSize = 'A4'; 
                            doc.content[1].table.widths = [50, 100, 100, 100, 100];
                            doc.content[1].table.heights = Array(table.rows({ page: 'current' }).count() + 1).join('*').split('');*/

                            doc.content[1].layout = {
                                hLineWidth: function(i, node) {
                                    return 1; 
                                },
                                vLineWidth: function(i, node) {
                                    return 1; 
                                },
                                hLineColor: function(i, node) {
                                    return 'black'; 
                                },
                                vLineColor: function(i, node) {
                                    return 'black'; 
                                },
                            };
                        }
                    } {% endcomment %}
                ]
            },                
                
            ],
            initComplete: function () {
                var api = this.api();
    
                
                api
                    .columns('')
                    .eq(0)
                    .each(function (colIdx) {
                        
                        var cell = $('.filters th').eq(
                            $(api.column(colIdx).header()).index()
                        );
                        var title = $(cell).text();
                        $(cell).html('<input class="Input" type="text" placeholder="' + title + '" style="text-align: center ;  width: auto;" />');
                        
                        $(
                            'input',
                            $('.filters th').eq($(api.column(colIdx).header()).index())
                        )
                            .off('keyup change')
                            .on('change', function (e) {
                                
                                $(this).attr('title', $(this).val());
                                var regexr = '({search})'; //$(this).parents('th').find('select').val();
    
                                var cursorPosition = this.selectionStart;
                                
                                api
                                    .column(colIdx)
                                    .search(
                                        this.value != ''
                                            ? regexr.replace('{search}', '(((' + this.value + ')))')
                                            : '',
                                        this.value != '',
                                        this.value == ''
                                    )
                                    .draw();
                            })
                            .on('keyup', function (e) {
                                e.stopPropagation();
    
                                $(this).trigger('change');
                                $(this)
                                    .focus()[0]
                                    .setSelectionRange(cursorPosition, cursorPosition);
                            });
                    });
                    
            },
            language: {
                info: 'Showing _START_ to _END_ of _TOTAL_ Rows',
                infoFiltered: '(filtered from _MAX_ total Rows)',
                emptyTable: "No data available",
                lengthMenu: 'Show <select>' +
                    '<option value="50">50</option>' +
                    '<option value="100">100</option>' +
                    '<option value="150">150</option>' +
                    '<option value="200">200</option>' +
                    '<option value="-1">All</option>' +
                    '</select> Rows',
                search: 'Search:',
                paginate: {
                    first: 'First',
                    last: 'Last',
                    next: 'Next',
                    previous: 'Previous'
                }
            },
        });

        $('select[name="example_length"] option[value="-1"]').text('All');
        
        table.buttons().container()
            .appendTo( '#example_wrapper .col-md-6:eq(0)' );

        var table = $('#example').DataTable();

        var dataTableLengthDiv = document.getElementById('example_length');

        var firstLabel = dataTableLengthDiv.querySelector('label');

        if (firstLabel) {
        firstLabel.classList.add('slr');
        }
    } );
</script>
<script>
    $(document).ready(function() {
        // Initialize DataTables instance
        // Remove the existing rows selection dropdown and pagination if needed
        $('.slr').remove();
        $('#example_paginate').remove();
        
        // Create the new form HTML for rows per page selection
        var formHtml = `
            <label class='slr' for="page_size">
            <form method="POST" action="/GroupWiseDashboard"> 
                {% csrf_token %}
                Show 
                <select name="GWD_page_size" id="GWD_page_size" onchange="this.form.submit()">
                    <option value="{{GWD_page_size}}" style='display:None;'{% if GWD_page_size|default_if_none:50 == 50 %}selected{% endif %}>{{GWD_page_size}}</option>
                    <option value="50" {% if GWD_page_size == 50 %}selected{% endif %}>50</option>
                    <option value="100" {% if GWD_page_size == 100 %}selected{% endif %}>100</option>
                    <option value="200" {% if GWD_page_size == 200 %}selected{% endif %}>200</option>
                    <option value="250" {% if GWD_page_size == 250 %}selected{% endif %}>250</option>
                    <option value="All" {% if GWD_page_size == 'All' %}selected{% endif %}>All</option>
                </select>
                Rows
                <input type="hidden" name="page" value="{{ page_obj.number }}">
            </form>
            </label>
        `;
    
        // Append the form to a specific element
        $('.dataTables_length').append(formHtml);

        // Update page length when selection is changed
        {% comment %} $('#GWD_page_size').on('change', function() {
            var pageSize = $(this).val();
            if (pageSize === 'All') {
                table.page.len(-1).draw(); // Show all rows if "All" is selected
            } else {
                table.page.len(parseInt(pageSize)).draw(); // Set to selected page length
            }
        });

        // Set the initial page length when the page loads (from the server-side)
        table.page.len({{ GWD_page_size|default:50 }}).draw(); {% endcomment %}
    });
</script>


<script>
    function deleteIPO(ipoId, pageNumber, btn) {
        if (!confirm("Are you sure you want to delete this IPO?")) {
            return false;
        }

        if (btn) {
            btn.disabled = true;
            btn.textContent = "Deleting...";
        }

        fetch(`/delete/${ipoId}/?page=${pageNumber}`, {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "X-CSRFToken": "{{ csrf_token }}"
            }
        })
        .then(res => {
            if (!res.ok) throw new Error("Network response was not ok");
            return res.json();
        })
        .then(data => {
            if (data.success) {
                alert("IPO deleted successfully!");
                location.reload(); // refresh table
            } else {
                alert("Error: " + (data.error || "Unknown error occurred"));
            }
        })
        .catch(error => {
            console.error("Error:", error);
            alert("Something went wrong while deleting IPO.");
        })
        .finally(() => {
            if (btn) {
                btn.disabled = false;
                btn.textContent = "Delete";
            }
        });
    }
</script>

<script>
    
$(document).ready(function() {
    $(".col-sm-12.col-md-6:first").addClass("custom-width");
    $(".col-sm-12.col-md-6").addClass("cw");
    $(".dt-row:first").addClass("table-responsive");
    $(".buttons-collection").addClass("d-flex justify-content-center align-items-center");

    var buttonGroup = '<div class="btn-group jvbtn bi d-flex" style="float:right; margin: 12px 16px; gap: 5px;">' +
        // Existing Payment button
        '<button type="button" class="btn btn-outline-primary jvbtn d-flex justify-content-center align-items-center" ' +
        'style="width: 120px;" data-bs-toggle="modal" ' +
        'onclick="document.getElementById(\'edit\').style.display=\'block\'" data-bs-target="#edit">' +
        'Payment' +
        '</button>' +
        // Add Transaction button
        '<button type="button" class="btn btn-sm btn-outline-secondary jvbtn d-flex justify-content-center align-items-center" ' +
        'style="width: 140px;" data-toggle="modal" data-target="#transactionModal">' +
        'Add Transaction' +
        '</button>' +
        // Add JV Transaction button
        '<button type="button" class="btn btn-sm btn-outline-secondary jvbtn d-flex justify-content-center align-items-center" ' +
        'style="width: 160px;" data-toggle="modal" data-target="#transactionModal1">' +
        'Add JV Transaction' +
        '</button>' +
        '</div>';
        
    $('.dataTables_length').append(buttonGroup);
});
</script>

<script src="{% static 'DataTables/js/jquery-3.7.0.js' %}"></script>
<script src="{% static 'DataTables/js/jquery.dataTables.min.js' %}"></script>
<script src="{% static 'DataTables/js/dataTables.fixedHeader.min.js' %}"></script>
<script src="{% static 'DataTables/js/dataTables.bootstrap5.min.js' %}"></script>
<script src="{% static 'DataTables/js/dataTables.buttons.min.js' %}"></script>
<script src="{% static 'DataTables/js/buttons.bootstrap5.min.js' %}"></script>
<script src="{% static 'DataTables/js/jszip.min.js' %}"></script>
<script src="{% static 'DataTables/js/buttons.html5.min.js' %}"></script>
<script src="{% static 'DataTables/js/buttons.print.min.js' %}"></script>
<script src="{% static 'DataTables/js/buttons.colVis.min.js' %}"></script>
<script src="{% static 'DataTables/js/pdfmake.min.js' %}"></script>
<script src="{% static 'DataTables/js/vfs_fonts.js' %}"></script>

{% endblock %}